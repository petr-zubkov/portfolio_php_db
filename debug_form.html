<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест контактной формы</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { max-width: 800px; margin-top: 50px; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .debug { background-color: #f8f9fa; color: #495057; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Тест контактной формы</h1>
        
        <div class="card">
            <div class="card-header">
                <h5>Отправка тестового сообщения</h5>
            </div>
            <div class="card-body">
                <form id="testForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Ваше имя</label>
                        <input type="text" class="form-control" id="name" name="name" value="Тестовый пользователь" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Ваш email</label>
                        <input type="email" class="form-control" id="email" name="email" value="test@example.com" required>
                    </div>
                    <div class="mb-3">
                        <label for="message" class="form-label">Ваше сообщение</label>
                        <textarea class="form-control" id="message" name="message" rows="4" required>Это тестовое сообщение для проверки работы контактной формы.</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Отправить сообщение</button>
                </form>
            </div>
        </div>

        <div id="result"></div>
    </div>

    <script>
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = this;
            const submitButton = form.querySelector('button[type="submit"]');
            const resultDiv = document.getElementById('result');
            
            // Получаем данные формы
            const formData = new FormData(form);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                message: formData.get('message')
            };
            
            // Показываем индикатор загрузки
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Отправка...';
            
            resultDiv.innerHTML = '<div class="result debug">Отправка данных...</div>';
            
            // Тестируем разные обработчики
            const urls = [
                'send_message.php',
                'send_message_simple.php',
                'send_message_improved.php',
                'test_form_post.php'
            ];
            
            let currentUrl = 0;
            
            function testNextUrl() {
                if (currentUrl >= urls.length) {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Отправить сообщение';
                    return;
                }
                
                const url = urls[currentUrl];
                resultDiv.innerHTML += `<div class="result debug">Тестируем: ${url}...</div>`;
                
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(data)
                })
                .then(response => response.json())
                .then(result => {
                    resultDiv.innerHTML += `<div class="result ${result.success ? 'success' : 'error'}">
                        <strong>${url}:</strong> ${result.message}
                        ${result.debug ? '<pre>' + JSON.stringify(result.debug, null, 2) + '</pre>' : ''}
                    </div>`;
                    
                    if (result.success) {
                        // Если успешно, можно остановить тестирование
                        submitButton.disabled = false;
                        submitButton.textContent = 'Отправить сообщение';
                    } else {
                        currentUrl++;
                        setTimeout(testNextUrl, 1000);
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML += `<div class="result error">
                        <strong>${url}:</strong> Ошибка сети: ${error.message}
                    </div>`;
                    currentUrl++;
                    setTimeout(testNextUrl, 1000);
                });
            }
            
            testNextUrl();
        });
    </script>
</body>
</html>